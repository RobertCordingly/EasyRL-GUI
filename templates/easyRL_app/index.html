{% extends "easyRL_app/base.html" %}
{% load static %}
{% block content %}
<div class="container-fluid" style="padding: 0px">
  <div class="row">
    <div class="card text-center">
      <div class="card-header">
        <ul class="nav nav-pills card-header-pills">
          <li class="nav-item">
            <input type="checkbox" class="btn-check" id="btn-con-train"  autocomplete="off" aria-checked checked >
            <label class="btn btn-outline-primary" for="btn-con-train" style="margin: 5px;" title="Continuous Training is Enabled.">Continuous Train</label>
          </li>
          <li class="nav-item">
            <button id="btn-train" class="btn btn-primary" style="margin:5px;" title="This trains the model" disabled>Train</button>
          </li>
          <li class="nav-item">
            <button id="btn-halt" class="btn btn-primary"style="margin:5px;">Halt</button>
          </li>
          <li class="nav-item">
            <button id="btn-test" class="btn btn-primary"style="margin:5px;" disabled>Test</button>
          </li> 
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle" data-bs-toggle="dropdown" href="#" role="button" aria-haspopup="true" aria-expanded="false" style="margin:5px;">Model </a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="import/"disabled>Save</a>
              <div class="dropdown-divider btn"></div>
              <a class="dropdown-item" href="export/">Load</a>
            </div>
          </li> 
          <li class="nav-item">
            <button class="btn btn-primary"style="margin:5px;">Save Result</button>
          </li>  
          <li class="nav-item"><a href='/easyRL_app/logout'>
            <button class="btn btn-primary"style="margin:5px;">Sign out</button></a>
          </li>                                                                               
        </ul>
      </div>
      <!-- Carousel -->
      <div class="card-body">
        <h5 id="file-name" class="card-title"></h5>
          <div class="row justify-content-center"style="margin-top: 0px">
            <div id="carouselExampleControlsNoTouching" class="carousel mbr-slider slide col-md-3" data-bs-touch="false" data-bs-interval="false">
              <div class="carousel-inner">
                {% for file in files %}
                {% if file == 'Cart Pole.jpg' %}
                <div class="carousel-item active">
                  <div class="d-flex justify-content-center w-100 h-100">
                      <img src="{% static 'easyRL_app/images/'%}{{file}}" data-name="{{file}}" alt="...">
                  </div>
                  </div>                        
                  {% else %}
                  <div class="carousel-item">
                    <div class="d-flex justify-content-center w-100 h-100">
                      <img src="{% static 'easyRL_app/images/'%}{{file}}" data-name="{{file}}" alt="...">
                    </div>
                  </div>
                  {% endif %}
                {% endfor %} 
              </div>
              <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControlsNoTouching" data-bs-slide="next">
              <span class="carousel-control-next-icon" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>  
          <br/>  
          <div style="margin:5px"> 
            <input list="environments" id="env-input" name="env-input"class="form-control " style="display:inline !important; width: 300px !important;">
              <datalist id="environments">
                <option>--Set Environment--</option>
                  {% for file in files %}
                  {% if file == 'Cart Pole.jpg' %}
                  <option selected value='{{ file|slice:":-4" }}'>{{ file|slice:":-4" }}</option>
                  {% elif file == 'Cart Pole Discrete.jpg'%}
                  <option value='{{ file|slice:":-4" }}'>{{ file|slice:":-4" }}</option>
                  {% elif file == 'Frozen Lake.jpg'%}
                  <option value='{{ file|slice:":-4" }}'>{{ file|slice:":-4" }}</option>
                  {% elif file == 'Pendulum.jpg'%}
                  <option value='{{ file|slice:":-4" }}'>{{ file|slice:":-4" }}</option>
                  {% elif file == 'Acrobot.jpg' %}
                  <option value='{{ file|slice:":-4" }}'>{{ file|slice:":-4" }}</option>
                  {% elif file == 'Mountain Car.jpg' %}
                  <option value='{{ file|slice:":-4" }}'>{{ file|slice:":-4" }}</option>
                  {% else %}
                  <option value='{{ file|slice:":-4" }}'>{{ file|slice:":-4"}}</option>
                  {% endif %}
                {% endfor %} 
      
              </datalist>
              
 </div>
 <br/>
 
          <button id="set-environment" class="btn btn-primary"><span class=""><i class="bi-card-image"></i></span> Select Environment</button>
    </div>
    </div>
  </div>
  <br/>
  <!-- Drop downs -->
  <div class="row justify-content-center " id="select-containers">

    <div class="col-md-3">
      <select class="form-select" id="agent-select" size="3" aria-label="Default select example">
          <option value="0">--Select Agent--</option>
          <option value="1" selected>Deep Q</option>
          <option value="2">Q Learning</option>
          <option value="3">DRQN</option>
          <option value="4">ADRQN</option>
          <option value="6">Double Dueling Deep Q Native</option>
          <option value="7">DRQN Native</option>
          <option value="8">Conv. DRQN Native</option>
          <option value="9">PPO Native</option>
          <option value="10">Reinforce Native</option>
          <option value="11">ActorCritic Native</option>
          <option value="5">SARSA</option>
      </select>
    </div>        
    <div class="col-md-3">
      <select id="buffer-select" class="form-select" size="3" aria-label="Default select example">
          <option value="0" selected>--Select Buffer--</option>
          <option value="1">Hindsight Replay Buffer</option>
          <option value="0">Prioritize Replay Buffer</option>
      </select> 
    </div>  
    <div class="col-md-3">           
      <select id="host-select"class="form-select" size="3" aria-label="Default select example">
        <option value="0">--Select Host Environment--</option>
        <optgroup label="ECS">
          <option value="1">c4.large</option>
          <option value="2"selected>c4.xlarge</option>
          <option value="3">c4.2xlarge</option>
          <option value="4">c4.4xlarge</option>
          <option value="5">c4.8xlarge</option>
        </optgroup>
        <optgroup label="Kubeflow">
          <option value="6">...</option>
          <option value="7">...</option>
          <option value="8">...</option>
          <option value="9">...</option>    
        </optgroup>                           
      </select> 
    </div> 
    <br/>
  </div>                                          
  <br/>  
  <div class="row">
    <!-- Tabs -->   
    <div class="col">
      <ul class="nav nav-tabs" id="myTab" role="tablist">
          <li class="nav-item" role="presentation">
            <button class="nav-link active" id="hp-tab-0" data-bs-toggle="tab" data-bs-target="#hp" type="button" role="tab" aria-controls="hp" aria-selected="true">Tab<i class="bi-dash-circle-fill"  style="color: red"></i></button>
          </li>
          <li class="nav-item" role="presentation">
            <button class="nav-link" id="add-model-tab" type="button" >Add <i class="bi-plus-circle-fill" style="color: #0b5ed7"></i></button>
          </li>
      </ul>
      <div class="tab-content" id="myTabContent">
        <div class="tab-pane fade show active" id="hp" role="tabpanel" aria-labelledby="hp-tab-0">
          <div class="image-container">
            <img id="training_image" src=""/>
            <div id="training_graph" style="width: 900px; height: 500px" class="float-start"></div>
          </div>        
      </div>
    </div>  
    </div> 
    <div class="col">
      <form method="post" style="margin-top: 15px;" >{% csrf_token %}
        <div id="form-div" class="container-fluid"></div>
      </form> 
    </div>        
  </div>
  </br>
  </br>
  </br>
  <div class="modal fade" id="modelName" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modelNameLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modelNameLabel">Enter Model Name</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div class="input-group mb-3">
            <span class="input-group-text" id="model-name-span">@</span>
            <input type="text" id="model-name-text" class="form-control" placeholder="Model Name" aria-label="ModelName" aria-describedby="model-name-input">
          </div>     
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="save-model-name" data-bs-dismiss="modal">Save Name</button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal fade" id="trainCompleted" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="trainCompletedLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="trainCompletedLabel">Enter Model Name</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            You can save this model, test it or train another model!
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" id="btn-ok" data-bs-dismiss="modal">OK</button>
        </div>
      </div>
    </div>
  </div>
</div>
<script src="{% static 'easyRL_app/scripts/jquery-3.5.1.min.js' %}"></script>
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript"> 
  $(document).ready(function(){    
    updateEnvironmentLabel();
    resetFormDropDownsButtons();
    $('html, body').animate({scrollTop: 0}, 800);
    google.charts.load('current', { 'packages':['corechart']}).then(draw_graph);
    
    setTimeout(function() {
      doPoll();
    }, 5000)  
  });
  $('#env-input').on('input', function() {
    var text = $(this).val();
    var index = carouselIndex(text);
    $('#carouselExampleControlsNoTouching').carousel(index)
  });
  $('#btn-con-train').change(function(){
    if ($('#btn-con-train').is(":checked")){
      $("#btn-halt").attr("disabled", "true");
      $("#btn-test").attr("disabled", "true");
      $('#btn-train').attr("disabled", "true");
    }else{
      if ($("#btn-train").is(":disabled") === false){
        $("#btn-halt").removeAttr("disabled");

      }
    }
  });

  function doPoll(){
    $.post('/easyRL_app/poll/', getData(), function (result, status, jqxhr){
         // process results here
         ReloadImageHelper(result);
        setTimeout(doPoll,5000);
    });
  }
  
  function draw_graph(episodes) {
  var length = episodes.length;
  var array = [];
  array.push(['Episode', 'Average Loss']);
  
  for (var index = 0; index < length; index++){
    array.push([
      episodes[index]["episode"],
      episodes[index]["avgLoss"]
    ]);
  }
  
  var data = google.visualization.arrayToDataTable(array);
  var options =
  {
    title: 'Training Average Losses',
    curveType: 'function',
    legend: { position: 'bottom' }
  };
      var chart = new google.visualization.LineChart(document.getElementById('training_graph'));
      chart.draw(data, options);
}
  // end function draw_graph()
  function ReloadImageHelper(result){
  let gifs = "";
  let episodes = "";
  let isRunning = true;
  if (result == "")
    {
      alert("The response is empty");
    }

    result = JSON.parse(result)
    if (result["error"] !== null)
    {
      // keep this line for debugging purpose
      //alert("There is no poll");
    }
    // assume that cloudBridge won't remove the key [instanceState]
    state = result["instanceState"]
    if (state === "idle")
    {
      $('#trainCompleted').modal('show');
      isRunning = false;
    }
    if (state === "booting" || state === "updated")
    {
      // keep this line for debugging purpose
      //alert("Booting or updated");
    }
    else if (state === "runningJob")
    {
      // loading data
      // data["jobArguments"]["environment"] -> 5
      // alert(data["progress"]);
      if (result["progress"] != "waiting")
      {
        gifs = result["progress"]["gifs"];
        episodes = result["progress"]["episodes"];
      }
    

    if(isRunning === false)
    {
        clearInterval(interval);
        // $("#training_summary").html("<button id='btn_reload' class='btn btn-primary' onclick='reload_image()' style='margin:5px;'>Reload</button>");
        return;
    }

        // $("#training_image").attr("src", '/easyRL_app/image/?' + (new Date()).getTime());
    if (gifs.length > 0)
    {
      $("#training_image").attr("src", gifs[gifs.length-1]);
      draw_graph(episodes);
    }
  }
}

  // Train button - Start
  $("#btn-train").click(function () {
    // get values from sliders
    $('#btn-halt').removeAttr("disabled");
    var data = getData();

    $.post('/easyRL_app/train/',data,function (result){
        if (result == "")
        {
          //alert("The response is empty");
          return;
        }
        result = JSON.parse(result);
        if (result["error"] !== null)
        {
          //alert("Could not start the training"); // instance not found
          return;
        }
        
        // alert("The training in progress");
    });
    resetFormDropDownsButtons();
    //reload_image();
  }); // Train Button - End
 
  $('#btn-ok').click(function() {
    $('#btn-train').attr("disabled", true);
    $('#btn-test').removeAttr("disabled");
    $('#btn-save').removeAttr("disabled");
  });

  $(".btn-close").click(function() {
    resetFormDropDownsButtons();
  });

  $('#save-model-name').click(function () {
    var modelName = $('#model-name-text').val();
    var tabLabel = modelName === "" ? $('#file-name').text() + "+" + $("#agent-select option:selected").text() : modelName;
    $("#hp-tab-0").html(tabLabel);
    $('#model-name-text').val("");
    $("#num-episodes-text").focus();
    $('html, body').animate({scrollTop: 800}, 800);
  });
  
  $('#btn-halt').click(function() {
    var data = {};
    $.post('/easyRL_app/halt/', data, function(result, status, jqxhr) {
        // do something
    })
  });

  $('#add-model-tab').click(function(e) {
      var nextTab = $('#myTab li').length+1;    
        // create the tab
        $("#myTab li:nth-child(2)").before($('<li class="nav-item" role="presentation"><button class="nav-link" id="hp-tab'+nextTab+'" data-bs-toggle="tab" data-bs-target="#hp'+nextTab+'" type="button" role="tab" aria-controls="hp'+nextTab+'" aria-selected="false">'+$("#file-name").text()+' <i class="bi-dash-circle-fill"  style="color: red"></i></button></li>'));
        // create the tab content
        $('<div class="tab-pane fade" id="hp'+nextTab+'" role="tabpanel" aria-labelledby="hp-tab'+nextTab+'">'+form+'</div>').appendTo('.tab-content');;
        // make the new tab active
        $('#myTab').on('click', function (e) {
          e.preventDefault()
          $(this).tab('show')
      });
  });

  $('#set-environment').click(function() {
    updateSelect($('#file-name').text())
    $('#agent-select').val(0);
    $('#agent-select').focus();
  });

  $('#carouselExampleControlsNoTouching').on('slid.bs.carousel', function(e) {
    //var c = $("div > .active", e.target).index();
    updateEnvironmentLabel();
    resetFormDropDownsButtons();
  });

  $("#agent-select" ).change(function () {
    var str = $("#agent-select option:selected" ).text();
    setFromElements(str);
    setFormElementsDefaultValues();
    $('#modelName').modal('show');
    
    // This set he agent for the model.
    var selectedVal = $("#agent-select option:selected" ).val();
    $("#agent-hidden").val(selectedVal);

    // This sets the environment of the model. 
    var fileName = $("#file-name").text();
    var selectedEnvironment = getEnvironmentIndex(fileName);
    $("#env-hidden").val(selectedEnvironment);
    $('#btn-train').removeAttr("disabled");
    $("#form-div").focus();
  }).change();

  function carouselIndex(itemName){
    var carouselInx ={
      'Acrobot' :   0
      ,'adventure': 1
      ,'air_raid':  2
      ,'alien':     3
      ,'amidar':4
      ,'assault':5
      ,'asterix':6
      ,'asteroids':7
      ,'atlantis':8
      ,'bank_heist':9
      ,'battle_zone':10
      ,'beam_rider':11
      ,'berzerk':12
      ,'bowling':13
      ,'boxing':14
      ,'breakout':15
      ,'carnival':16
      ,'Cart Pole Discrete':17
      ,'Cart Pole' :18
      ,'centipede':19
      ,'chopper_command':20
      ,'crazy_climber':21
      ,'demon_attack':22
      ,'double_dunk':23
      ,'elevator_action':24
      ,'enduro':25
      ,'fishing_derby':26
      ,'freeway':27
      ,'frostbite':28
      ,'Frozen Lake':29
      ,'gopher':30
      ,'gravitar':31
      ,'hero':32
      ,'ice_hockey':33
      ,'jamesbond':34
      ,'journey_escape':35
      ,'kangaroo':36
      ,'krull':37
      ,'kung_fu_master':38
      ,'montezuma_revenge':39
      ,'Mountain Car': 40
      ,'ms_pacman':41
      ,'name_this_game':42
      ,'Pendulum': 43
      ,'phoenix':44
      ,'pitfall':45
      ,'pong':46
      ,'pooyan':47
      ,'private_eye':48
      ,'qbert':49
      ,'riverraid':50
      ,'road_runner':51
      ,'robotank':52
      ,'seaquest':53
      ,'skiing':54
      ,'solaris':55
      ,'space_invaders':56
      ,'star_gunner':57
      ,'tennis':58
      ,'time_pilot':59
      ,'tutankham':60
      ,'up_n_down':61
      ,'venture':62
      ,'video_pinball':63
      ,'wizard_of_wor':64
      ,'yars_revenge':65
      ,'zaxxon':66
    }

    return carouselInx[itemName];
  }

  function getEnvironmentIndex(environmentName){
    var envDict = {
       'Cart Pole' :1
      ,'Cart Pole Discrete':2
      ,'Frozen Lake':3
      ,'Pendulum':4
      ,'Acrobot':5
      ,'Mountain Car':6
      ,'adventure':7
      ,'air_raid':8
      ,'alien':9
      ,'amidar':10
      ,'assault':11
      ,'asterix':12
      ,'asteroids':13
      ,'atlantis':14
      ,'bank_heist':15
      ,'battle_zone':16
      ,'beam_rider':17
      ,'berzerk':18
      ,'bowling':19
      ,'boxing':20
      ,'breakout':21
      ,'carnival':22
      ,'centipede':23
      ,'chopper_command':24
      ,'crazy_climber':25
      ,'demon_attack':26
      ,'double_dunk':27
      ,'elevator_action':28
      ,'enduro':29
      ,'fishing_derby':30
      ,'freeway':31
      ,'frostbite':32
      ,'gopher':33
      ,'gravitar':34
      ,'hero':35
      ,'ice_hockey':36
      ,'jamesbond':37
      ,'journey_escape':38
      ,'kangaroo':39
      ,'krull':40
      ,'kung_fu_master':41
      ,'montezuma_revenge':42
      ,'ms_pacman':43
      ,'name_this_game':44
      ,'phoenix':45
      ,'pitfall':46
      ,'pong':47
      ,'pooyan':48
      ,'private_eye':49
      ,'qbert':50
      ,'riverraid':51
      ,'road_runner':52
      ,'robotank':53
      ,'seaquest':54
      ,'skiing':55
      ,'solaris':56
      ,'space_invaders':57
      ,'star_gunner':58
      ,'tennis':59
      ,'time_pilot':60
      ,'tutankham':61
      ,'up_n_down':62
      ,'venture':63
      ,'video_pinball':64
      ,'wizard_of_wor':65
      ,'yars_revenge':66
      ,'zaxxon':67
    }
    return envDict[environmentName];
  }

  function updateSelect(fileName){
    var games = {
          'Cart Pole' : ['Deep Q', 'DRQN', 'ADRQN','Double Dueling Deep Q Native', 'DRQN Native', 'PPO Native', 'Reinforce Native', 'ActorCritic Native']
          ,'Cart Pole Discrete' : ['Deep Q', 'Q Learning', 'DRQN', 'ADRQN','Double Dueling Deep Q Native', 'DRQN Native', 'PPO Native', 'Reinforce Native', 'ActorCritic Native','SARSA']
          ,'Frozen Lake': ['Deep Q', 'Q Learning', 'DRQN', 'ADRQN','Double Dueling Deep Q Native', 'DRQN Native', 'PPO Native', 'Reinforce Native', 'ActorCritic Native','SARSA']
          ,'Pendulum' : ['Deep Q', 'DRQN', 'ADRQN','Double Dueling Deep Q Native', 'DRQN Native', 'PPO Native', 'Reinforce Native', 'ActorCritic Native']
          ,'Acrobot': ['Deep Q', 'DRQN', 'ADRQN','Double Dueling Deep Q Native', 'DRQN Native', 'PPO Native', 'Reinforce Native', 'ActorCritic Native']
          ,'Mountain Car' : ['Deep Q', 'DRQN', 'ADRQN','Double Dueling Deep Q Native', 'DRQN Native', 'PPO Native', 'Reinforce Native', 'ActorCritic Native']
          ,'default' : ['DRQN', 'ADRQN', 'Conv. DRQN Native']
        };

      switch(fileName){
        case 'Acrobot':
          $("#agent-select > option").each(function() {   
            if (games[fileName].indexOf(this.text) !== -1){
                this.disabled = false;
              }
          });
          break;
        case 'Cart Pole':
          $("#agent-select > option").each(function() {   
              if (games[fileName].indexOf(this.text) !== -1){
                this.disabled = false;
              }
          });
          break;
        case 'Cart Pole Discrete':
          $("#agent-select > option").each(function() {   
            if (games[fileName].indexOf(this.text) !== -1){
                this.disabled = false;
              }
          });           
          break;
        case 'Fronzen Lake':
          $("#agent-select > option").each(function() {   
            if (games[fileName].indexOf(this.text) !== -1){
                this.disabled = false;
              }
          });
          break;
        case 'Mountain Car':
          $("#agent-select > option").each(function() {   
            if (games[fileName].indexOf(this.text) !== -1){
                this.disabled = false;
              }
          });
          break;           
        default:
          $("#agent-select > option").each(function() {   
            if (games['default'].indexOf(this.text) !== -1){
                this.disabled = false;
              }
          });
          break;
      }     
  }
  
  function track_training_progress() {  
    var image = document.getElementById("graph-image");   
    var value = "True";  
    var loop = setInterval(load_image, 1000);  
    
    function load_image() {    
      if (value != "True"){
        clearInterval(loop)
      } 
      else {      
        $.ajax({
          url: '/easyRL_app/test/',
          dataType: 'text',
          success: function (data) {
            value = data;
          }
        });
        
        $.ajax({
          url: '/easyRL_app/image/',
          dataType: 'image/gif',
          success: function (data) {
            alert("test");
            if (data) {
              $("#graph-image").attr("src", data);
            }
          }
        });
      }  
    }
  }

  function updateEnvironmentLabel() {
    var src = $('.active').find('img').attr('src');
    src = src.slice(26,-4);
    $("#file-name").html(src); 
  }

  function resetFormDropDownsButtons() {
    setFromElements(""); 
    resetDropDowns();
    resetButtons();
    resetEnvironment();
  }

  function resetDropDowns() {
    $('#agent-select').val(1);
    $('#buffer-select').val(1);
    $('#host-select').val(2);
    $('#environment-select').val(1);   
  }

  function resetButtons() {
    $('#btn-train').attr("disabled", "true");
    $('#btn-test').attr("disabled", "true");
    $('#btn-save').attr("disabled", "true");
    $('#btn-halt').attr("disabled", "true");
  }

  function resetEnvironment(){
    $('#env-hidden').val(getEnvironmentIndex("Cart Pole"));
  }
  
  function setFormElementsDefaultValues() {
    $("#batch-text").val($("#batch-slider").val());
    $("#batch-slider").on('input',function(){
      var newval=$(this).val();
      $("#batch-text").val(newval);
    }); 
    
    $("#gamma-text").val($("#gamma-slider").val());
    $("#gamma-slider").on('input',function(){
      var newval=$(this).val();
      $("#gamma-text").val(newval);
    }); 

    $("#alpha-text").val($("#alpha-slider").val());
    $("#alpha-slider").on('input',function(){
      var newval=$(this).val();
      $("#alpha-text").val(newval);
    }); 
    
    $("#min-epsilon-text").val($("#min-epsilon-slider").val());
    $("#min-epsilon-slider").on('input',function(){
      var newval=$(this).val();
      $("#min-epsilon-text").val(newval);
    }); 
    
    $("#max-epsilon-text").val($("#max-epsilon-slider").val());
    $("#max-epsilon-slider").on('input',function(){
      var newval=$(this).val();
      $("#max-epsilon-text").val(newval);
    }); 
    
    $("#decay-slider").on('input',function(){
      var newval=$(this).val();
      $("#decay-text").val(newval);
    }); 

    $("#learning-rate-text").val($("#learning-rate-slider").val());
    $("#learning-rate-slider").on('input', function(){
      var newval=$(this).val();
      $("#learning-rate-text").val(newval);
    });

    $("#dep-text").val( $("#dep-slider").val());
    $("#dep-slider").on('input',function(){
      var newval=$(this).val();
      $("#dep-text").val(newval);
    });  

    $("#plr-text").val( $("#plr-slider").val());
    $("#plr-slider").on('input',function(){
      var newval=$(this).val();
      $("#plr-text").val(newval);
    });  

    $("#vlr-text").val( $("#vlr-slider").val());
    $("#vlr-slider").on('input',function(){
      var newval=$(this).val();
      $("#vlr-text").val(newval);
    });  
  };

  function getData() {
    var data = {
      "environment": !!$('#env-hidden').val() ? $('#env-hidden').val() : "1"
      ,"instanceType": $("#host-select option:selected" ).text()
      ,"continuousTraining": $('#btn-con-train').is(":checked") ? "True" : "False"
      ,"agent": !!$("#agent-hidden").val() ? $("#agent-hidden").val() : "1"
      ,"killTime": 600
      ,"episodes": !!$("#num-episodes-text").val() ? $("#num-episodes-text").val() : "1000"
      ,"steps": !!$('#max-size-text').val() ?$('#max-size-text').val() : "200"
      ,"gamma": !!$('#gamma-text').val() ? $('#gamma-text').val() : "0.97"
      ,"minEpsilon": !!$('#min-epsilon-text').val() ? $('#min-epsilon-text').val() : "0.018"
      ,"maxEpsilon": !!$('#max-epsilon-text').val() ? $('#max-epsilon-text').val() : "1"
      ,"decayRate": !!$('#decay-text').val() ?$('#decay-text').val()  : "0.018"
      ,"batchSize": !!$('#batch-text').val() ? $('#batch-text').val() : "32"
      ,"memorySize": !!$('#memory-size-text').val() ? $('#memory-size-text').val() : "1000"
      ,"targetInterval": !!$('#target-update-interval-text').val() ? ('#target-update-interval-text').val() : "200"
      ,"alpha": $('#alpha-text').val()
      ,"historyLength": $('#history-text').val()             
    };
    return data;
  }

 // start function draw_graph()



 // start function reload_image()
 function reload_image() {
  var gifs = "";
  var episodes = "";
  var isRunning = true;
  var interval = setInterval(function() {
    var data = getData();

    $.post('/easyRL_app/poll/',data,function (result){
    if (result == "")
    {
      alert("The response is empty");
    }

    result = JSON.parse(result)
    if (result["error"] !== null)
    {
      // keep this line for debugging purpose
      //alert("There is no poll");
    }
    // assume that cloudBridge won't remove the key [instanceState]
    state = result["instanceState"]
    if (state === "idle")
    {
      $('#trainCompleted').modal('show');
      isRunning = false;
    }
    if (state === "booting" || state === "updated")
    {
      // keep this line for debugging purpose
      //alert("Booting or updated");
    }
    else if (state === "runningJob")
    {
      // loading data
      // data["jobArguments"]["environment"] -> 5
      // alert(data["progress"]);
      if (result["progress"] != "waiting")
      {
        gifs = result["progress"]["gifs"];
        episodes = result["progress"]["episodes"];
      }
    }});

    if(isRunning === false)
    {
        clearInterval(interval);
        // $("#training_summary").html("<button id='btn_reload' class='btn btn-primary' onclick='reload_image()' style='margin:5px;'>Reload</button>");
        return;
    }

        // $("#training_image").attr("src", '/easyRL_app/image/?' + (new Date()).getTime());
    if (gifs.length > 0)
    {
      $("#training_image").attr("src", gifs[gifs.length-1]);
      draw_graph(episodes);
    }
      
  }, 5000);
}
 // end function reload_image()

 function setFromElements(str) {
    str = simpleFormFactory(str);
    $( "#form-div" ).html(str); 
  
}
 
 function simpleFormFactory(agent) {
 
     var defaults =     '<div class="row">'
 
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>';
 
 var deepQ =     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""><input type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>'
           +'     <div class="row">'
           +'       <div class="col-6">'
           +'       <label>Target Update Interval</label>'
           +'       <div class="col-12"  ><input type="text" id="target-update-interval-text" class="form-control " value="200"></div>'
           +'       </div>'
           +'       <div class="col-md-6">'
           +'          <label>Memory Size</label>'
           +'          <div class="col-md-12" ><input type="text" id="memory-size-text" class="form-control" value="1000"></div>'
           +'       </div>'
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Batch Size</label>'
           +         '<div class=""  ><input   type="range" id="batch-slider" class="form-range" name="batch-slider" min="0" max="256" step="1" value="32"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="batch-text" value="32" readonly></div>'
           +'       </div>'

           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'
           +'      </div>';  
 
 var qLearning =      '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input   type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>'
           +'      <div class="row>'
           +'       <div class="slider-container col-6">'
           +'         <label>Alpha</label>'
           +         '<div class=""  ><input   type="range" id="alpha-slider" class="form-range" name="alpha-slider" min="0" max="1" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="alpha-text" value="0.18" readonly></div>'
           +'       </div>' 

           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'
           +'      </div>';  
 
 var drqn =     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970" disabled></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Target Update Interval</label>'
           +'       <div class="col-12"  ><input type="text" id="target-update-interval-text" class="form-control " value="200"></div>'
           +'       </div>'
           +'     </div>'
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'       <div class="col-md-6">'
           +'          <label>Memory Size</label>'
           +'          <div class="col-md-12" ><input type="text" id="memory-size-text" class="form-control" value="1000"></div>'
           +'       </div>'
           +'     </div>' 
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Batch Size</label>'
           +         '<div class=""  ><input   type="range" id="batch-slider" class="form-range" name="batch-slider" min="0" max="256" step="1" value="32"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="batch-text" value="32" readonly></div>'
           +'       </div>'
           +'       <div class="col-md-6">'
           +'          <label>History Length</label>'
           +'          <div class="col-md-12" ><input type="text" id="history-text" value="10"  class="form-control" value=""></div>'
           +'       </div>'
           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'
           +'      </div>'; 
 
 var doubleDueling =     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input   type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>'
           +'     <div class="row">'
           +'       <div class="col-6">'
           +'       <label>Target Update Interval</label>'
           +'       <div class="col-12"  ><input type="text" id="target-update-interval-text" class="form-control " value="200"></div>'
           +'       </div>'
           +'       <div class="col-md-6">'
           +'          <label>Memory Size</label>'
           +'          <div class="col-md-12" ><input type="text" id="memory-size-text" class="form-control" value="1000"></div>'
           +'       </div>'
           +'     </div>' 
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Batch Size</label>'
           +         '<div class=""  ><input   type="range" id="batch-slider" class="form-range" name="batch-slider" min="0" max="256" step="1" value="32"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="batch-text" value="32" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Learning Rate</label>'
           +         '<div class=""  ><input   type="range" id="learning-rate-slider" class="form-range" name="learning-rate-slider" min="0" max="100" step="0.001" value="0.001"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="learning-rate-text" value="0.001" readonly></div>'
           +'       </div>' 
           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'
           +'      </div>';
 
 var convDRQNNative =      '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input   type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>';
           +'     <div class="row">'
           +'       <div class="col-6">'
           +'       <label>Target Update Interval</label>'
           +'       <div class="col-12"  ><input type="text" id="target-update-interval-text" class="form-control " value="200"></div>'
           +'       </div>'
           +'       <div class="col-md-6">'
           +'          <label>Memory Size</label>'
           +'          <div class="col-md-12" ><input type="text" id="memory-size-text" class="form-control" value="1000"></div>'
           +'       </div>'
           +'     </div>' 
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Batch Size</label>'
           +         '<div class=""  ><input   type="range" id="batch-slider" class="form-range" name="batch-slider" min="0" max="256" step="1" value="32"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="batch-text" value="32" readonly></div>'
           +'       </div>'
           +'       <div class="col-md-6">'
           +'          <label>History Length</label>'
           +'          <div class="col-md-12" ><input type="text" id="history-text" value="10"  class="form-control" value=""></div>'
           +'       </div>'
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Batch Size</label>'
           +         '<div class=""  ><input   type="range" id="batch-slider" class="form-range" name="batch-slider" min="0" max="256" step="1" value="32"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="batch-text" value="32" readonly></div>'
           +'       </div>'
           +'      <div class="row>'
           +'       <div class="slider-container col-6">'
           +'         <label>Learning Rate</label>'
           +         '<div class=""  ><input   type="range" id="learning-rate-slider" class="form-range" name="learning-rate-slider" min="0" max="100" step="0.001" value="0.001"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="learning-rate-text" value="0.001" readonly></div>'
           +'       </div>'
           +'        </div>'
           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'
           +'      </div>';
           +'      </div>'
 
 var actorCritc =     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input   type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>' 
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Policy Learn Rate</label>'
           +         '<div class=""  ><input   type="range" id="plr-slider" class="form-range" name="plr-slider" min="0" max="1" step="0.001" value="0.001"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="plr-text" value="" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>History</label>'
           +       '<div class="col-md-12"  ><input type="text" id="history-text" value="10"  class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Value Learn Rate</label>'
           +         '<div class=""  ><input   type="range" id="vlr-slider" class="form-range" name="vlr-slider" min="0" max="1" step="0.001" value="0.001"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="vlr-text" value="0.001" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Epoch</label>'
           +'       <div class="col-12"><input type="text" id="epoch-text" class="form-control" value="500"></div>'
           +'       </div>'
           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'           
           +'     </div> ';
 
 var reinforceNative =     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input   type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>'
           +'      <div class="row>'
           +'       <div class="slider-container col-6">'
           +'         <label>Learning Rate</label>'
           +         '<div class=""  ><input   type="range" id="plt-slider" class="form-range" name="plr-slider" min="0" max="1" step="0.001" value="0.001"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="plr-text" value="" readonly></div>'
           +'       </div>'

           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'
           +'      </div>';
 
 var ppoNative =      '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input   type="range" id="gamma-slider" class="form-range" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>' 
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Batch Size</label>'
           +         '<div class=""  ><input   type="range" id="batch-slider" class="form-range" name="batch-slider" min="0" max="256" step="1" value="32"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="batch-text" value="32" readonly></div>'
           +'       </div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Policy Learn Rate</label>'
           +         '<div class=""  ><input   type="range" id="plr-slider" class="form-range" name="plr-slider" min="0" max="1" step="0.001" value="0.001"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="plr-text" value="" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>History</label>'
           +       '<div class="col-md-12"  ><input type="text" id="history-text" value="10"  class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Value Learn Rate</label>'
           +         '<div class=""  ><input   type="range" id="vlr-slider" class="form-range" name="vlr-slider" min="0" max="1" step="0.001" value="0.001"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="vlr-text" value="0.001" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Epoch</label>'
           +'       <div class="col-12"><input type="text" id="epoch-text" class="form-control" value="500"></div>'
           +'       </div>'
           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'           
           +'     </div> ';
 
 
 // SARSA
 var sarsa =     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Gamma</label>'
           +         '<div class=""  ><input   type="range" id="gamma-slider" class="form-range col-4" name="gamma-slider" min="0" max="1" step="0.001" value="0.970"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="gamma-text" value="0.97" readonly></div>'
           +       '</div>'
           +       '<div class="col-md-6">'
           +         '<label>Number of Episodes</label>'
           +       '<div class="col-md-12"><input type="text" id="num-episodes-text" value="1000" alt="range: 0-655360" class="form-control"></div>'
           +     '</div>'
           +     '</div>'
           +     '<div class="row">'
           +       '<div class="slider-container col-6">'
           +         '<label>Min Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="min-epsilon-slider" class="form-range" name="min-epsilon-slider" min="0" max="1" step="0.001" value="0.10"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="min-epsilon-text" value="" readonly></div>'
           +'       </div>'
           +'       <div class="col-6">'
           +'       <label>Steps</label>'
           +'       <div class="col-12"><input type="text" id="max-size-text" value="200" class="form-control"></div>'
           +'       </div>'
           +'     </div> '
           +'     <div class="row">'
           +'       <div class="slider-container col-6">'
           +'         <label>Max Epsilon</label>'
           +         '<div class=""  ><input   type="range" id="max-epsilon-slider" class="form-range" name="max-epsilong-slider" min="0" max="1" step="0.001" value="1"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="max-epsilon-text" value="1" readonly></div>'
           +'       </div>'
           +'       <div class="slider-container col-6">'
           +'         <label>Decay Rate</label>'
           +         '<div class=""  ><input   type="range" id="decay-slider" class="form-range" name="decay-slider" min="0" max="0.2" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="decay-text" value="0.18" readonly></div>'
           +'       </div>'
           +'     </div>';
           +'      <div class="row>'
           +'       <div class="slider-container col-6">'
           +'         <label>Alpha</label>'
           +         '<div class=""  ><input   type="range" id="alpha-slider" class="form-range" name="alpha-slider" min="0" max="1" step="0.001" value="0.18"></div>'
           +         '<div class="" style="margin: 0px 50px 0px 50px;"><input type="text" class="form-control" id="alpha-text" value="0.18" readonly></div>'
           +'       </div>' 

           +'        <input type="hidden" id="env-hidden" class="form-control">'
           +'        <input type="hidden" id="agent-hidden" class="form-control">'
           +'      </div>';                     
 
 
   var result = "";
   switch(agent){
       case "Deep Q":
           result = deepQ;
           break;
       case "Q Learning":
           result = qLearning;
           break;
       case "DRQN":
           result = drqn;
           break;
       case "ADRQN":
           result = drqn;
           break;
       case "Double Dueling Deep Q Native":
           result = doubleDueling;
           break;
       case "DRQN Native":
           result = drqn;
           break;
       case "Conv. DRQN Native":
           result =convDRQNNative;
       case "PPO Native":
           result = ppoNative;
           break;
       case "Reinforce Native":
           result = reinforceNative;
           break;
       case "ActorCritic Native":
           result = actorCritc;
           break;
       case "SARSA":
           result = sarsa;
           break;
       default: 
         result ="";
   }
   return result
 }

</script>  
{%endblock%}